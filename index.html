<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìš°ì„±ê³  ì¹´ë“œ ì„¤ì¹˜</title>

  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#e0e5ec" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ìš°ì„±ê³  ì¹´ë“œ" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <style>
    /* ê¸°ë³¸ ì´ˆê¸°í™” */
    html, body {
      height: 100%;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ (ê·¸ë¼ë°ì´ì…˜) */
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(-45deg, #e0e5ec, #d1d9e6, #c8d0e7, #b8c6dc);
      background-size: 400% 400%;
      animation: bg 15s ease infinite;
      color: #3d4a5c;
    }
    @keyframes bg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ì¹´ë“œ ë””ìì¸ (ë‰´ëª¨í”¼ì¦˜) */
    .wrap { width: min(560px, 92vw); }
    .card {
      background: #e0e5ec;
      border-radius: 26px;
      padding: 30px 26px;
      box-shadow: 9px 9px 16px rgba(163,177,198,0.7), -9px -9px 16px rgba(255,255,255,0.9);
      text-align: center;
    }

    h1 { margin: 0 0 10px; font-size: 1.6rem; color: #3d4a5c; }
    
    /* ì„¤ëª… í…ìŠ¤íŠ¸ */
    .desc {
      color: #5a677b;
      margin-bottom: 20px;
      line-height: 1.5;
      font-size: 1.05rem;
      word-break: keep-all;
    }

    /* í™˜ê²½ ë±ƒì§€ */
    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
      font-size: 0.9rem;
      color: #5a677b;
      margin-bottom: 10px;
    }

    /* ê²½ê³  ë©”ì‹œì§€ (ì¹´í†¡ ë“±) */
    .warn {
      margin-top: 10px;
      font-weight: 800;
      color: #d63031;
      font-size: 0.95rem;
    }

    /* ì„¤ì¹˜ ìˆœì„œ ë¦¬ìŠ¤íŠ¸ */
    ol {
      margin: 15px 0 0 0;
      padding-left: 20px;
      text-align: left;
      line-height: 1.8;
      color: #5a677b;
      display: inline-block; /* ë¦¬ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ ì •ë ¬ëœ ë°•ìŠ¤ ì•ˆì—ì„œ ì™¼ìª½ ì •ë ¬ */
    }
    li { margin: 8px 0; }

    /* ë²„íŠ¼ ì˜ì—­ */
    .btns {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-top: 24px;
    }

    /* âœ…âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì¤‘ì•™ ì •ë ¬ + íŒŒë€ìƒ‰ ì ìš© ì™„ë£Œ) âœ…âœ… */
    button {
      border: 0;
      border-radius: 14px;
      padding: 14px 24px;
      cursor: pointer;

      /* íŒŒë€ìƒ‰ ë°°ê²½ */
      background: #2563eb;
      color: #ffffff;
      font-weight: 800;
      font-size: 1rem;

      /* ê·¸ë¦¼ì */
      box-shadow: 6px 6px 12px rgba(163, 177, 198, 0.45), -6px -6px 12px rgba(255, 255, 255, 0.75);

      /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ í•µì‹¬ ì½”ë“œ */
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      
      width: 100%;
      max-width: 240px; /* ë²„íŠ¼ ìµœëŒ€ í¬ê¸° */
      margin: 0 auto;
      
      line-height: 1.2; /* í•œê¸€ ìˆ˜ì§ ì •ë ¬ ë³´ì • */
    }
    button:active { transform: translateY(2px); box-shadow: inset 4px 4px 8px rgba(0,0,0,0.2); }

    /* ì‘ì€ ì•ˆë‚´ ë¬¸êµ¬ */
    .small {
      margin-top: 20px;
      font-size: 0.85rem;
      color: #6b7890;
      line-height: 1.4;
    }

    /* ì‹¤ì œ ì•±(iframe) - í‰ì†Œì—” ìˆ¨ê¹€ */
    iframe {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      display: none;
      background: #fff;
      -webkit-overflow-scrolling: touch;
    }

    /* ìˆ¨ê¹€ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
    .hide { display: none !important; }
  </style>

  <script>
    // âœ… ìš°ì„±ê³  ì¹´ë“œ ì‹œìŠ¤í…œ ì£¼ì†Œ (ìˆ˜ì •ëœ ìƒˆ ì£¼ì†Œ ì ìš©ë¨)
    const APP_URL = "https://script.google.com/macros/s/AKfycbzLyWl4cHIEmwPDhjMGADoWN1MHa2OLhkVtcJldWDlHzRgyz-Yb9CGNleaiwmrV1-ZvBg/exec";

    // ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ (PWA í•„ìˆ˜)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js", { scope: "./" }).catch(console.error);
    }
  </script>
</head>

<body>

<iframe
  id="appFrame"
  title="ìš°ì„±ê³  ì¹´ë“œ ì‹œìŠ¤í…œ"
  allow="camera; microphone; geolocation; autoplay; fullscreen">
</iframe>

<div id="installUI" class="wrap">
  <div class="card">
    <h1>ğŸ“± ìš°ì„±ê³  ì¹´ë“œ</h1>
    <p class="desc" id="topMsg">ì•± ì‚¬ìš©ì„ ìœ„í•´ ì„¤ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>

    <div>
      <span class="badge" id="envBadge">í™˜ê²½ í™•ì¸ ì¤‘â€¦</span>
      <div id="warnMsg" class="warn hide">
        âš ï¸ ì¹´ì¹´ì˜¤í†¡/ë„¤ì´ë²„ì—ì„œëŠ” ì„¤ì¹˜ ë¶ˆê°€<br>ì™¸ë¶€ ë¸Œë¼ìš°ì €ë¡œ ì—´ì–´ì£¼ì„¸ìš”.
      </div>
    </div>

    <ol id="steps"></ol>

    <div class="btns">
      <button id="installBtn" class="hide" type="button">ì•± ì„¤ì¹˜í•˜ê¸°</button>
    </div>

    <div class="small">
      ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ í™ˆ í™”ë©´ì— ì¶”ê°€ëœ<br><b>[ìš°ì„±ê³  ì¹´ë“œ]</b> ì•„ì´ì½˜ìœ¼ë¡œ ì ‘ì†í•´ì£¼ì„¸ìš”.
    </div>
  </div>
</div>

<script>
  const $ = id => document.getElementById(id);

  // ì•± í™”ë©´ ë³´ì—¬ì£¼ê¸° í•¨ìˆ˜
  function showApp() {
    $("installUI").classList.add("hide");
    const f = $("appFrame");
    f.src = APP_URL;
    f.style.display = "block";
  }

  // ì„¤ëª… ë¦¬ìŠ¤íŠ¸ ë§Œë“œëŠ” í•¨ìˆ˜
  function setSteps(arr) {
    const ol = $("steps");
    if (arr.length === 0) {
      ol.innerHTML = "";
      ol.style.display = "none"; // ë‚´ìš© ì—†ìœ¼ë©´ ìˆ¨ê¹€
    } else {
      ol.style.display = "inline-block";
      ol.innerHTML = arr.map(v => `<li>${v}</li>`).join("");
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    // 1. ì´ë¯¸ ì•±(Standalone)ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
    const isStandalone = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;

    if (isStandalone) {
      showApp(); // ë°”ë¡œ ì•± ì‹¤í–‰
      return;
    }

    // 2. ë¸Œë¼ìš°ì € í™˜ê²½ ê°ì§€
    const ua = navigator.userAgent.toLowerCase();
    const isiOS = /iphone|ipad|ipod/.test(ua);
    const isAndroid = /android/.test(ua);
    
    // ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ (ì¹´í†¡, ë„¤ì´ë²„, ì¸ìŠ¤íƒ€, í˜ë¶ ë“±)
    const isInApp = ua.includes("kakaotalk") || (ua.includes("naver") && ua.includes("inapp")) || ua.includes("instagram") || ua.includes("fbav") || ua.includes("line");

    // ë±ƒì§€ í…ìŠ¤íŠ¸ ì„¤ì •
    $("envBadge").textContent = isInApp ? "ì¸ì•± ë¸Œë¼ìš°ì €" : isiOS ? "iOS (ì•„ì´í°)" : "Android (ì•ˆë“œë¡œì´ë“œ)";

    // 3. ìƒí™©ë³„ í™”ë©´ ì²˜ë¦¬

    // [CASE A] ì¸ì•± ë¸Œë¼ìš°ì € (ì„¤ì¹˜ ë¶ˆê°€ -> ê²½ê³  í‘œì‹œ)
    if (isInApp) {
      $("warnMsg").classList.remove("hide");
      $("topMsg").innerHTML = "ì§€ê¸ˆì€ <b>ì„ì‹œ í™”ë©´</b>ì…ë‹ˆë‹¤.<br>ì„¤ì¹˜ë¥¼ ìœ„í•´ ë¸Œë¼ìš°ì €ë¥¼ ë°”ê¿”ì£¼ì„¸ìš”.";
      setSteps([
        "í™”ë©´ì˜ <b>[ì  3ê°œ]</b> ë˜ëŠ” <b>[ê³µìœ ]</b> ë²„íŠ¼ í´ë¦­",
        "<b>[ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°]</b> ì„ íƒ (Chrome/Safari)",
        "ìƒˆë¡œ ì—´ë¦° ì°½ì—ì„œ ì„¤ì¹˜ ì§„í–‰"
      ]);
      return; // ë²„íŠ¼ ì•ˆ ë³´ì—¬ì¤Œ
    }

    // [CASE B] ì•„ì´í° (iOS)
    if (isiOS) {
      $("topMsg").innerHTML = "ì•„ì´í°ì€ <b>í™ˆ í™”ë©´ì— ì¶”ê°€</b>í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.";
      setSteps([
        "í•˜ë‹¨ ë˜ëŠ” ìƒë‹¨ì˜ <b>ê³µìœ  ë²„íŠ¼(<i class='fa-solid fa-arrow-up-from-bracket'></i>)</b> í´ë¦­",
        "ë©”ë‰´ì—ì„œ <b>[í™ˆ í™”ë©´ì— ì¶”ê°€]</b> ì„ íƒ",
        "ìš°ì¸¡ ìƒë‹¨ <b>[ì¶”ê°€]</b> ë²„íŠ¼ í´ë¦­"
      ]);
      return; // ë²„íŠ¼ ì•ˆ ë³´ì—¬ì¤Œ (iOSëŠ” ë²„íŠ¼ìœ¼ë¡œ ì„¤ì¹˜ ë¶ˆê°€)
    }

    // [CASE C] ì•ˆë“œë¡œì´ë“œ (í¬ë¡¬/ì‚¼ì„±ì¸í„°ë„· ë“±)
    // ì„¤ëª…ì€ ìˆ¨ê¸°ê³ , ë²„íŠ¼ë§Œ ëŒ€ê¸°
    $("topMsg").innerHTML = "ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ ì„¤ì¹˜í•˜ì„¸ìš”.";
    setSteps([]);

    let deferredPrompt = null;
    
    // ë¸Œë¼ìš°ì €ê°€ ì„¤ì¹˜ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë˜ë©´ ì´ë²¤íŠ¸ ë°œìƒ
    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      // ì„¤ì¹˜ ë²„íŠ¼ ë“±ì¥!
      $("installBtn").classList.remove("hide");
    });

    // ë²„íŠ¼ í´ë¦­ ì‹œ ì„¤ì¹˜ ì°½ ë„ìš°ê¸°
    $("installBtn").addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice.catch(() => {});
      deferredPrompt = null;
      $("installBtn").classList.add("hide"); // ì„¤ì¹˜ í›„ ë²„íŠ¼ ìˆ¨ê¹€
    });
  });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

</body>
</html>
