<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìš°ì„±ê³  ì¹´ë“œ ì„¤ì¹˜</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#e0e5ec" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ìš°ì„±ê³  ì¹´ë“œ" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <style>
    html, body { height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; }
    body {
      display: flex; justify-content: center; align-items: center;
      background: linear-gradient(-45deg, #e0e5ec, #d1d9e6, #c8d0e7, #b8c6dc);
      background-size: 400% 400%;
      animation: gradient-bg 15s ease infinite;
      color: #3d4a5c;
    }
    @keyframes gradient-bg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .wrap { width: min(560px, 92vw); }
    .card {
      background: #e0e5ec;
      border-radius: 26px;
      padding: 26px;
      box-shadow: 9px 9px 16px rgba(163, 177, 198, 0.7), -9px -9px 16px rgba(255, 255, 255, 0.9);
    }
    h1 { margin: 0 0 8px; font-size: 1.6rem; text-align: center; }
    .desc { margin: 0 0 14px; color: #5a677b; text-align: center; line-height: 1.5; }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
      font-size: 0.9rem;
    }
    .center { text-align: center; }

    .warn {
      margin-top: 10px;
      color: #d63031;
      font-weight: 800;
    }

    ol { margin: 12px 0 0 18px; padding: 0; color: #5a677b; line-height: 1.8; }
    li { margin: 8px 0; }

    .btns { display: flex; justify-content: center; margin-top: 16px; }
    button {
      border: 0;
      border-radius: 14px;
      padding: 12px 16px;
      cursor: pointer;
      background: #ffffff80;
      color: #2f3a4a;
      font-weight: 800;
      box-shadow: 6px 6px 12px rgba(163, 177, 198, 0.45), -6px -6px 12px rgba(255, 255, 255, 0.75);
    }
    button:active { transform: translateY(1px); }

    iframe {
      border: 0;
      width: 100%;
      height: 100%;
      position: fixed;
      inset: 0;
      display: none;
      -webkit-overflow-scrolling: touch;
      background: #fff;
    }

    .hide { display: none !important; }
    .small { font-size: 0.9rem; color: #6b7890; margin-top: 12px; line-height: 1.5; text-align: center; }
  </style>

  <script>
    // âœ… GAS ì›¹ì•± ì£¼ì†Œ
    const APP_URL = "https://script.google.com/macros/s/AKfycbzLyWl4cHIEmwPDhjMGADoWN1MHa2OLhkVtcJldWDlHzRgyz-Yb9CGNleaiwmrV1-ZvBg/exec";

    // ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js", { scope: "./" }).catch(console.error);
    }
  </script>
</head>

<body>
  <iframe
    id="appFrame"
    title="ìš°ì„±ê³  ì¹´ë“œ"
    allow="camera; microphone; geolocation; autoplay; payment; fullscreen"
  ></iframe>

  <div id="installUI" class="wrap">
    <div class="card">
      <h1>ğŸ“± ìš°ì„±ê³  ì¹´ë“œ ì„¤ì¹˜ ì•ˆë‚´</h1>
      <p class="desc" id="topMsg">í™ˆ í™”ë©´ì— ì¶”ê°€í•´ì„œ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.</p>

      <div class="center">
        <span class="badge" id="envBadge">í™˜ê²½ í™•ì¸ ì¤‘â€¦</span>
        <div id="warnMsg" class="warn hide">ì¸ì•± ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì„¤ì¹˜ê°€ ì•ˆ ë  ìˆ˜ ìˆì–´ìš”.</div>
      </div>

      <ol id="steps"></ol>

      <!-- ì•ˆë“œë¡œì´ë“œì—ì„œ beforeinstallprompt ëœ° ë•Œë§Œ ë‚˜íƒ€ë‚˜ëŠ” ë²„íŠ¼ -->
      <div class="btns">
        <button id="installBtn" class="hide" type="button">ì„¤ì¹˜í•˜ê¸°</button>
      </div>

      <div class="small">
        ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ í™ˆ í™”ë©´ì˜ ì•„ì´ì½˜ìœ¼ë¡œ ì‹¤í–‰í–ˆì„ ë•Œ ìë™ìœ¼ë¡œ ì•± í™”ë©´ì´ ì—´ë¦½ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    function setSteps(items) {
      const ol = $("steps");
      ol.innerHTML = "";
      items.forEach((t) => {
        const li = document.createElement("li");
        li.innerHTML = t;
        ol.appendChild(li);
      });
    }

    function showApp() {
      $("installUI").classList.add("hide");
      const f = $("appFrame");
      f.src = APP_URL;
      f.style.display = "block";
    }

    document.addEventListener("DOMContentLoaded", () => {
      // 1) ì„¤ì¹˜(standalone) ì‹¤í–‰ì´ë©´ ì•± í‘œì‹œ
      const isStandalone =
        window.matchMedia("(display-mode: standalone)").matches ||
        window.navigator.standalone === true;

      if (isStandalone) {
        showApp();
        return;
      }

      // 2) í™˜ê²½ ê°ì§€
      const ua = (navigator.userAgent || "").toLowerCase();
      const isiOS = /iphone|ipad|ipod/.test(ua);
      const isAndroid = /android/.test(ua);

      const isInApp =
        ua.includes("kakaotalk") ||
        ua.includes("kakao") ||
        (ua.includes("naver") && ua.includes("inapp")) ||
        ua.includes("daumapps") ||
        ua.includes("instagram") ||
        ua.includes("fbav") ||
        ua.includes("fban") ||
        ua.includes("snapchat") ||
        ua.includes("line");

      let badge = "ì¼ë°˜ ë¸Œë¼ìš°ì €";
      if (isInApp) badge = "ì¸ì•± ë¸Œë¼ìš°ì €(ì¹´í†¡/ë„¤ì´ë²„ ë“±)";
      else if (isiOS) badge = "iPhone / iPad";
      else if (isAndroid) badge = "Android";
      $("envBadge").textContent = badge;

      // 3) ì•ˆë‚´
      if (isInApp) {
        $("warnMsg").classList.remove("hide");
        $("topMsg").innerHTML =
          "ì§€ê¸ˆì€ <b style='color:#d63031'>ì•± ì•ˆì—ì„œ ì—´ë¦° í™”ë©´</b>ì´ë¼ ì„¤ì¹˜ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆì–´ìš”.<br/>ë¨¼ì € <b>ì™¸ë¶€ ë¸Œë¼ìš°ì €</b>ë¡œ ì—´ì–´ì£¼ì„¸ìš”.";

        setSteps([
          "ìƒë‹¨/í•˜ë‹¨ì˜ <b>ê³µìœ </b> ë˜ëŠ” <b>â‹¯(ì  3ê°œ)</b> ë©”ë‰´ë¥¼ ëˆ„ë¥´ì„¸ìš”.",
          "<b>â€œë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸° / ê¸°ë³¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°â€</b>ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
          "ì™¸ë¶€ ë¸Œë¼ìš°ì €ë¡œ ì—´ë¦° ë’¤, ì•„ë˜ ì„¤ì¹˜ ë°©ë²•ëŒ€ë¡œ <b>í™ˆ í™”ë©´ì— ì¶”ê°€</b>ë¥¼ ì§„í–‰í•˜ì„¸ìš”."
        ]);
      } else if (isiOS) {
        $("topMsg").innerHTML =
          "iOSëŠ” ë³´í†µ <b>ê³µìœ  ë©”ë‰´ â†’ í™ˆ í™”ë©´ì— ì¶”ê°€</b>ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.";

        setSteps([
          "<b>ê³µìœ  ë²„íŠ¼(â¬†ï¸)</b>ì„ ëˆ„ë¥´ì„¸ìš”.",
          "ëª©ë¡ì—ì„œ <b>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</b>ë¥¼ ì°¾ì•„ ëˆ„ë¥´ì„¸ìš”.",
          "ìš°ì¸¡ ìƒë‹¨ <b>â€œì¶”ê°€â€</b>ë¥¼ ëˆ„ë¥´ì„¸ìš”.",
          "â€» ë§Œì•½ <b>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</b>ê°€ ì•ˆ ë³´ì´ë©´ <b>Safarië¡œ ì—´ì–´ì„œ</b> ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
        ]);
      } else {
        $("topMsg").innerHTML =
          "ì•ˆë“œë¡œì´ë“œëŠ” <b>ì•± ì„¤ì¹˜</b> ë˜ëŠ” <b>í™ˆ í™”ë©´ì— ì¶”ê°€</b>ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.";

        setSteps([
          "ìš°ì¸¡ ìƒë‹¨ <b>â‹®(ì  3ê°œ)</b> ë©”ë‰´ë¥¼ ëˆ„ë¥´ì„¸ìš”.",
          "<b>â€œì•± ì„¤ì¹˜â€</b> ë˜ëŠ” <b>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</b>ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
          "<b>ì„¤ì¹˜</b>ë¥¼ ëˆŒëŸ¬ ì™„ë£Œí•˜ì„¸ìš”."
        ]);
      }

      // 4) ì•ˆë“œë¡œì´ë“œ(ì§€ì› ë¸Œë¼ìš°ì €)ì—ì„œë§Œ 'ì„¤ì¹˜í•˜ê¸°' ë²„íŠ¼ í™œì„±í™”
      let deferredPrompt = null;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        $("installBtn").classList.remove("hide");
      });

      $("installBtn").addEventListener("click", async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; } catch (e) {}
        deferredPrompt = null;
        $("installBtn").classList.add("hide");
      });
    });
  </script>
</body>
</html>
