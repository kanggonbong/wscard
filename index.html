<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>ìš°ì„±ê³  ì¹´ë“œ</title>

  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#e0e5ec" />
  
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ìš°ì„±ê³  ì¹´ë“œ" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <style>
    /* 1. ê¸°ë³¸ ì„¤ì • */
    html, body { height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    body {
      display: flex; justify-content: center; align-items: center;
      background: linear-gradient(-45deg, #e0e5ec, #d1d9e6, #c8d0e7, #b8c6dc);
      background-size: 400% 400%;
      animation: bg 15s ease infinite;
      color: #3d4a5c;
    }
    @keyframes bg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .wrap { width: min(560px, 90vw); }
    .card {
      background: #e0e5ec;
      border-radius: 26px;
      padding: 32px 24px;
      box-shadow: 9px 9px 16px rgba(163,177,198,0.7), -9px -9px 16px rgba(255,255,255,0.9);
      text-align: center;
    }

    h1 { margin: 0 0 12px; font-size: 1.6rem; color: #3d4a5c; word-break: keep-all; }
    .desc { color: #5a677b; margin-bottom: 20px; line-height: 1.5; font-size: 1.05rem; word-break: keep-all; }
    
    .badge { 
      display: inline-block; padding: 6px 14px; 
      border-radius: 999px; background: rgba(0,0,0,0.06); 
      font-size: 0.9rem; color: #5a677b; margin-bottom: 12px; 
    }

    /* 2. âœ…âœ…âœ… ë²„íŠ¼/ë§í¬ ê°•ì œ ì¤‘ì•™ ì •ë ¬ (í•µì‹¬ CSS) âœ…âœ…âœ… */
    /* idë¥¼ ì§ì ‘ ì§€ì •í•´ì„œ ìš°ì„ ìˆœìœ„ ìµœìƒìœ¼ë¡œ ì„¤ì • */
    #installBtn, 
    #chromeBtn {
      /* [ì¤‘ìš”] ë§í¬ì˜ ê¸°ë³¸ ì„±ì§ˆ(ë°‘ì¤„, ì™¼ìª½ì •ë ¬) ì œê±° */
      text-decoration: none !important;
      -webkit-appearance: none !important;
      appearance: none !important;
      border: 0 !important;

      /* [ì¤‘ìš”] Flexboxë¡œ ë¬´ì¡°ê±´ ì¤‘ì•™ ì •ë ¬ */
      display: flex !important;
      justify-content: center !important; /* ì¢Œìš° ì¤‘ì•™ */
      align-items: center !important;     /* ìƒí•˜ ì¤‘ì•™ */
      text-align: center !important;      /* í…ìŠ¤íŠ¸ ì¤‘ì•™ */

      /* ë””ìì¸: íŒŒë€ìƒ‰ ë²„íŠ¼ */
      background: #2563eb !important;
      color: #ffffff !important;
      border-radius: 14px !important;
      font-weight: 800 !important;
      font-size: 1rem !important;
      box-shadow: 6px 6px 12px rgba(163, 177, 198, 0.45), -6px -6px 12px rgba(255, 255, 255, 0.75) !important;

      /* í¬ê¸° ì„¤ì • */
      width: 100% !important;
      max-width: 260px !important;
      margin: 20px auto 0 auto !important; /* ë²„íŠ¼ ìì²´ë¥¼ í™”ë©´ ê°€ìš´ë°ë¡œ */
      padding: 16px 20px !important;
      box-sizing: border-box !important;
      
      /* ì¤„ë§ì¶¤ ë³´ì • */
      line-height: 1.2 !important;
      font-family: inherit !important;
      cursor: pointer !important;
    }

    #installBtn:active, #chromeBtn:active {
      transform: translateY(2px);
      box-shadow: inset 3px 3px 6px rgba(0,0,0,0.2) !important;
    }

    /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    #installBtn span, #chromeBtn span {
      display: block; width: 100%; text-align: center;
    }

    .small { margin-top: 22px; font-size: 0.85rem; color: #6b7890; line-height: 1.4; word-break: keep-all; }
    
    iframe { position: fixed; inset: 0; width: 100%; height: 100%; border: 0; display: none; background: #fff; z-index: 9999; }
    .hide { display: none !important; }
  </style>

  <script>
    // âœ… ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì†Œ
    const APP_URL = "https://script.google.com/macros/s/AKfycbzLyWl4cHIEmwPDhjMGADoWN1MHa2OLhkVtcJldWDlHzRgyz-Yb9CGNleaiwmrV1-ZvBg/exec";

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js", { scope: "./" }).catch(console.error);
    }
  </script>
</head>

<body>

<iframe id="appFrame" allow="camera; microphone; geolocation; autoplay; fullscreen"></iframe>

<div id="installUI" class="wrap">
  <div class="card">
    <h1>ğŸ“± ìš°ì„±ê³  ì¹´ë“œ</h1>
    
    <p class="desc" id="topMsg">í™˜ê²½ì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>

    <div>
      <span class="badge" id="envBadge">í™•ì¸ ì¤‘â€¦</span>
    </div>

    <button id="installBtn" class="hide" type="button">
      <span>ì•± ì„¤ì¹˜í•˜ê¸°</span>
    </button>

    <a id="chromeBtn" class="hide" href="#" target="_blank">
      <span>í¬ë¡¬ìœ¼ë¡œ ê³„ì†í•˜ê¸°</span>
    </a>

    <div class="small" id="footNote">
      ì„¤ì¹˜ í›„ í™ˆ í™”ë©´ì— ì¶”ê°€ëœ ì•„ì´ì½˜ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”.
    </div>
  </div>
</div>

<script>
  const $ = id => document.getElementById(id);
  function showApp() { $("installUI").classList.add("hide"); const f = $("appFrame"); f.src = APP_URL; f.style.display = "block"; }

  document.addEventListener("DOMContentLoaded", () => {
    // 1. ì•± ëª¨ë“œì¸ì§€ í™•ì¸
    const isStandalone = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    if (isStandalone) { showApp(); return; }

    // 2. í™˜ê²½ ê°ì§€
    const ua = navigator.userAgent.toLowerCase();
    const isiOS = /iphone|ipad|ipod/.test(ua);
    const isAndroid = /android/.test(ua);
    
    // í¬ë¡¬ì¸ì§€ í™•ì¸ (ì‚¼ì„±ì¸í„°ë„· ë“± ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì™€ êµ¬ë¶„)
    // í¬ë¡¬ì€ ë³´í†µ 'chrome'ì´ ìˆê³  'samsungbrowser'ë‚˜ 'edge' ê°™ì€ ê²Œ ì—†ì–´ì•¼ ìˆœì • í¬ë¡¬ìœ¼ë¡œ ë´„
    const isChrome = /chrome/.test(ua) && !/samsungbrowser/.test(ua) && !/edge/.test(ua) && !/whale/.test(ua);
    const isInApp = ua.includes("kakaotalk") || (ua.includes("naver") && ua.includes("inapp")) || ua.includes("instagram") || ua.includes("line");

    // ë±ƒì§€ í…ìŠ¤íŠ¸
    if (isInApp) $("envBadge").textContent = "ì¸ì•± ë¸Œë¼ìš°ì €";
    else if (isAndroid && !isChrome) $("envBadge").textContent = "ì‚¼ì„±/ê¸°íƒ€ ë¸Œë¼ìš°ì €";
    else if (isiOS) $("envBadge").textContent = "iOS";
    else $("envBadge").textContent = "Chrome";


    // ---------------------------------------------------------
    // [ìƒí™© 1] ì•ˆë“œë¡œì´ë“œì¸ë° í¬ë¡¬ì´ ì•„ë‹ ë•Œ (ì‚¼ì„±ì¸í„°ë„·, ì¹´í†¡ ë“±)
    // -> "í¬ë¡¬ìœ¼ë¡œ ê³„ì†í•˜ê¸°" ë²„íŠ¼ í‘œì‹œ
    // ---------------------------------------------------------
    if (isAndroid && !isChrome) {
      $("topMsg").innerHTML = "ì›í™œí•œ ì„¤ì¹˜ë¥¼ ìœ„í•´<br><b>í¬ë¡¬ ë¸Œë¼ìš°ì €</b>ì—ì„œ ì§„í–‰í•´ì£¼ì„¸ìš”.";
      
      // Intent ì£¼ì†Œ ìƒì„±: ì•ˆë“œë¡œì´ë“œ ì‹œìŠ¤í…œì— "í¬ë¡¬ìœ¼ë¡œ ì´ ì£¼ì†Œ ì—´ì–´ì¤˜!"ë¼ê³  ìš”ì²­
      const intentUrl = "intent://" + APP_URL.replace(/^https?:\/\//, "") + "#Intent;scheme=https;package=com.android.chrome;end";
      
      const btn = $("chromeBtn");
      btn.href = intentUrl; 
      btn.classList.remove("hide"); // ë²„íŠ¼ ë“±ì¥
      return;
    }

    // ---------------------------------------------------------
    // [ìƒí™© 2] iOS (ì•„ì´í°)
    // ---------------------------------------------------------
    if (isiOS) {
      $("topMsg").innerHTML = "<b>ê³µìœ  ë²„íŠ¼ <i class='fa-solid fa-arrow-up-from-bracket'></i></b>ì„ ëˆ„ë¥´ê³ <br><b>[í™ˆ í™”ë©´ì— ì¶”ê°€]</b>ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
      return;
    }

    // ---------------------------------------------------------
    // [ìƒí™© 3] ì§„ì§œ í¬ë¡¬ ë¸Œë¼ìš°ì € (ì„¤ì¹˜ ê°€ëŠ¥)
    // ---------------------------------------------------------
    $("topMsg").innerHTML = "ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ì¹˜í•˜ì„¸ìš”.";
    
    let deferredPrompt = null;
    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      $("installBtn").classList.remove("hide"); // ì„¤ì¹˜ ë²„íŠ¼ ë“±ì¥
    });

    $("installBtn").addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice.catch(() => {});
      deferredPrompt = null;
      $("installBtn").classList.add("hide");
    });
  });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</body>
</html>
